{% extends "base.html" %}
{% load static %}

{% block title %}Organization :: RadioDNS{% endblock %}

{% block content %}

    {% block pageheader %}
        <div class="menubar">
            <div class="sidebar-toggler visible-xs">
                <i class="ion-navicon"></i>
            </div>
            <div class="page-title">
                {{ organization.short_name }} :: Configuration
                <small class="hidden-xs">{% block pagesubtitle %} {% endblock %}</small>
            </div>
            <div id="page-functions" class="pull-right">
                <a href="{% url 'manager:edit'%}" class="btn btn-primary">Edit</a>
            </div>
        </div>
    {% endblock %}
    {% block alerts %}
    {{ block.super }}
        {% if not logo %}
            <div class="alert alert-danger" role="alert">
                  <p><strong>No Default Provider Image has been defined.</strong> <br/>
                      User the provider image section to add your default image.</p>
                  <p><a href="{% url 'manager:new_image' %}" class="btn btn-info">Add a new image</a>
                      <a href="{% url 'manager:list_images' %}" class="btn btn-info">Set an existing image</a></p>
            </div>
        {% endif %}
    {% endblock %}
        <div class="row">
            <div class="col-md-8">
                <h3>Current configuration:</h3>
                <div class="table-responsive">
                    <table class="table table-striped table-hover table-condensed">
                        <tbody>
                        <tr>
                            <th>CODOPS</th>
                            <td><i>{{ organization.codops }}</i></td>
                        </tr>
                        <tr>
                            <th>Short Name</th>
                            <td>{{ organization.short_name }}</td>
                        </tr>
                        <tr>
                            <th>Medium Name</th>
                            <td>{{ organization.medium_name }}</td>
                        </tr>
                        <tr>
                            <th>Long Name</th>
                            <td>{{ organization.long_name }}</td>
                        </tr>
                        <tr>
                            <th>Short Description</th>
                            <td>{{ organization.short_description }}</td>
                        </tr>
                        <tr>
                            <th>Long Description</th>
                            <td>{{ organization.long_description }}</td>
                        </tr>
                        <tr>
                            <th>Default Url</th>
                            <td><a href="{{ organization.url_default }}"
                                   target="_blank">{{ organization.url_default }}</a>
                            </td>
                        </tr>
                        <tr>
                            <th>Default Language</th>
                            <td>{{ organization.default_language }}</td>
                        </tr>
                        <tr>
                            <th>Postal Address</th>
                            <td>{{ organization.postal_name }}<br/>
                                {{ organization.street }}<br/>
                                {{ organization.city }}{% if organization.zipcode %},
                                {{ organization.zipcode }}{% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th>Country</th>
                            <td>{{ organization.location_country }}</td>
                        </tr>
                        <tr>
                            <th>Phone Number</th>
                            <td>{{ organization.phone_number }}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            {% if logo %}
                    <div class="col-md-3 col-md-offset-1">
                        <img style="width: 100%; max-width:600px;"
                             src="{{logo.file.url}}">
                    </div>
            {% endif %}
        </div>

        <div class="row">

                <h3>Bucket & DNS Configuration Check:</h3>

                <div class="table-responsive">
                    <table class="table table-striped table-hover table-condensed">
                        <tbody>
                        <tr>
                            <th style="width:200px;">Status</th>
                            <td><span id="radiodns-serviceprovider-status" class="label label-default">Loading</span>
                            </td>
                        </tr>
                        <tr>
                            <th>Bucket</th>
                            <td><span id="radiodns-serviceprovider-bucket"><i class="ion-load-c"></i></span></td>
                        </tr>
                        <tr>
                            <th>Bucket name</th>
                            <td><span id="radiodns-serviceprovider-bucketname"><i class="ion-load-c"></i></span></td>
                        </tr>
                        <tr>
                            <th>Bucket public endpoint</th>
                            <td><span id="radiodns-serviceprovider-bucketendpoint"><i class="ion-load-c"></i></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Bucket CNAME</th>
                            <td><span id="radiodns-serviceprovider-bucketcname"><i class="ion-load-c"></i></span></td>
                        </tr>
                        <tr>
                            <th>Bucket CNAME Record</th>
                            <td><span id="radiodns-serviceprovider-bucketcnameentry"><i class="ion-load-c"></i></span>
                            </td>
                        </tr>
                        <tr>
                            <th>DNS Zone</th>
                            <td><span id="radiodns-serviceprovider-zone"><i class="ion-load-c"></i></span></td>
                        </tr>
                        <tr>
                            <th>&nbsp;</th>
                            <td><span id="radiodns-serviceprovider-zonens"><i class="ion-load-c"></i></span></td>
                        </tr>
                        <tr>
                            <th>Parent NS Entry</th>
                            <td><span id="radiodns-serviceprovider-parent"><i class="ion-load-c"></i></span></td>
                        </tr>
                        <tr>
                            <th>&nbsp;</th>
                            <td><span id="radiodns-serviceprovider-parentns"><i class="ion-load-c"></i></span></td>
                        </tr>
                        <tr>
                            <th>VIS Service</th>
                            <td><span id="radiovis-service"><i class="ion-load-c"></i></span></td>
                        </tr>
                        <tr>
                            <th>EPG Service</th>
                            <td><span id="radioepg-service"><i class="ion-load-c"></i></span></td>
                        </tr>
                        <tr>
                            <th>SPI Service</th>
                            <td><span id="radiospi-service"><i class="ion-load-c"></i></span></td>
                        </tr>
                        <tr>
                            <th>TAG Service</th>
                            <td><span id="radiotag-service"><i class="ion-load-c"></i></span></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <script src="{% static 'js/ajaxq.js' %}"></script>
            <script type="text/javascript">
                function checkProvider() {
                    $.ajaxq("rdns-serviceproviderq", {
                        url: "{% url 'manager:check' %}",
                        dataType: 'json',
                        success: function (data) {
                            if (data.isvalid) {
                                $('#radiodns-serviceprovider-status').html('Success');
                                $('#radiodns-serviceprovider-status').removeClass('label-default');
                                $('#radiodns-serviceprovider-status').addClass('label-success');
                            } else {
                                $('#radiodns-serviceprovider-status').html('Failed');
                                $('#radiodns-serviceprovider-status').removeClass('label-default');
                                $('#radiodns-serviceprovider-status').addClass('label-danger');
                            }

                            if (data.bucket) {
                                $('#radiodns-serviceprovider-bucket').html('Success');
                                $('#radiodns-serviceprovider-bucket').addClass('text-success');
                                $('#radiodns-serviceprovider-bucketname').html(data.bucket.name);
                                $('#radiodns-serviceprovider-bucketendpoint').html(data.bucket.publicendpoint);
                                $('#radiodns-serviceprovider-bucketcname').html(data.bucket.cname.name);
                                $('#radiodns-serviceprovider-bucketcnameentry').html(data.bucket.cname.record);
                                if (data.bucket.publicendpoint != data.bucket.cname.record) {
                                    $('#radiodns-serviceprovider-bucketcnameentry').addClass('text-danger');
                                }
                            } else {
                                $('#radiodns-serviceprovider-bucket').html('Missing');
                                $('#radiodns-serviceprovider-bucket').addClass('text-danger');
                            }

                            if (data.zone) {
                                $('#radiodns-serviceprovider-zone').html(data.zone.zone);
                                $('#radiodns-serviceprovider-zone').addClass('text-success');
                                $('#radiodns-serviceprovider-zonens').html(data.zone.ns);
                            } else {
                                $('#radiodns-serviceprovider-zone').html('Missing');
                                $('#radiodns-serviceprovider-zone').addClass('text-danger');
                            }

                            if (data.parentns) {
                                $('#radiodns-serviceprovider-parent').html(data.parentns.entry);
                                $('#radiodns-serviceprovider-parent').addClass('text-success');
                                $('#radiodns-serviceprovider-parentns').html(data.parentns.value);
                            } else {
                                $('#radiodns-serviceprovider-parent').html('Missing');
                                $('#radiodns-serviceprovider-parent').addClass('text-danger');
                            }
                            if (data.services) {
                                $('#radiovis-service').html(data.services.vis.name + " <i class=\"ion-arrow-right-c\"></i> " + data.services.vis.value);
                                $('#radiovis-service').addClass('text-success');
                                $('#radioepg-service').html(data.services.epg.name + " <i class=\"ion-arrow-right-c\"></i> " + data.services.epg.value);
                                $('#radioepg-service').addClass('text-success');
                                $('#radiospi-service').html(data.services.spi.name + " <i class=\"ion-arrow-right-c\"></i> " + data.services.spi.value);
                                $('#radiospi-service').addClass('text-success');
                                $('#radiotag-service').html(data.services.tag.name + " <i class=\"ion-arrow-right-c\"></i> " + data.services.tag.value);
                                $('#radiotag-service').addClass('text-success');
                            } else {
                                $('#radiovis-service').html('Error');
                                $('#radiovis-service').addClass('text-danger');
                                $('#radioepg-service').html('Error');
                                $('#radioepg-service').addClass('text-danger');
                                $('#radiospi-service').html('Error');
                                $('#radiospi-service').addClass('text-danger');
                                $('#radiotag-service').html('Error');
                                $('#radiotag-service').addClass('text-danger');
                            }
                        }
                    });
                }

                checkProvider();

            </script>


{% endblock %}


