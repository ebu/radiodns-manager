{% extends "plugIt/base.html" %}
{% load plugit_tags %}

{% block title %}Stations :: RadioDNS{% endblock %}

{% block menubar %}
    {% plugitInclude "menubar" %}
{% endblock %}

{% block content %}

    {% block pageheader %}
    <div class="menubar">
        <div class="sidebar-toggler visible-xs">
            <i class="ion-navicon"></i>
        </div>
        <div class="page-title">
            {{ebuio_orga.name}} :: Edit a station
            <small class="hidden-xs">{% block pagesubtitle %} {% endblock %}</small>
        </div>
        <div id="page-functions" class="pull-right">{% block pagefunctions %} {% endblock %}</div>
        <div id="page-search" class="pull-right">{% block pagesearch %} {% endblock %}</div>
    </div>
    {% endblock %}

	{% if errors %}
		<div class="alert alert-error">
			<ul>
				{% for e in errors %}
					<li>{{e}}</li>
				{% endfor %}
			</ul>
		</div>
	{% endif %}

	<form action="" method="POST" class="form-horizontal">
		{% csrf_token %}


		<div class="form-group">
			<label class="col-sm-3 col-md-3 control-label">Name:</label>
			<div class="col-sm-9 col-md-7">
				<input type="text" name="name" id="station-name" class="form-control" value="{{object.name}}"><br />
				<small>Technical Description for usernames and RadioDNS Naming.</small>
			</div>
		</div>
		{% if object.id %}
		<div class="form-group" id="station-name-change-warning" style="display:none;">
			<div class="col-sm-9 col-md-7 col-sm-offset-3 alert alert-danger" role="alert">
				<p><strong>Changing the Station's name is not recommended as this will require manual DNS changes.</strong> <br />
				Please contact Mathias Coinchon (<a href="mailto:coinchon@ebu.ch">coinchon@ebu.ch</a>) for further information</p>
			</div>
		</div>
		{% endif %}

		<hr />

		<div class="form-group">
			<label class="col-sm-3 col-md-3 control-label">Short name (8 chars)</label>
			<div class="col-sm-9 col-md-7">
				<input type="text" name="short_name" class="form-control" value="{{object.short_name}}" maxlength="8">
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-md-3 control-label">Medium name (16 chars)</label>
			<div class="col-sm-9 col-md-7">
				<input type="text" name="medium_name" class="form-control" value="{{object.medium_name}}" maxlength="16">
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-md-3 control-label">Long name (128 chars)</label>
			<div class="col-sm-9 col-md-7">
				<input type="text" name="long_name" class="form-control" value="{{object.long_name}}" maxlength="128">
			</div>
		</div>

		<hr />

		<div class="form-group">
			<label class="col-sm-3 col-md-3 control-label">Short description (180 chars)</label>
			<div class="col-sm-9 col-md-7">
				<input type="text" name="short_description" class="form-control" value="{{object.short_description}}" maxlength="180">
			</div>
		</div>

		{% comment %}
		<div class="form-group">
			<label class="col-sm-3 col-md-3 control-label">Long description (1200 chars)</label>
			<div class="col-sm-9 col-md-7">
				<input type="text" name="long_description" class="form-control" value="{{object.long_description}}" maxlength="180">
			</div>
		</div>
		{% endcomment %}

		<hr />
		<div class="form-group">
			<label class="col-sm-3 col-md-3 control-label">Default Url:</label>
			<div class="col-sm-9 col-md-7">
				<input type="text" name="url_default" class="form-control" value="{{object.url_default}}" maxlength="255">
			</div>
		</div>
		<hr />

		<div class="form-group">
			<label class="col-sm-3 col-md-3 control-label">Genres:</label>
			<div class="col-sm-9 col-md-7">
				<table class="table table-condensed" id="genre_list">

					{#<tr><th></th><th>Href (e.g.:  <i>urn:tva:metadata:cs:ContentCS:2004:3.1.1.11</i>)</th><th>Name (e.g: <i>Local/Regional</i>)</th><th></th></tr>#}
                    <tr id="genre_row_template" class="genre_row" style="display:none;" >
                        <td>
                            <select id="genre-select-" class="genre-select form-control">
                                <option value="">--</option>
                                <option value="3.1.1">News</option>
                                <option value="3.1.1.11">Local/Regional</option>
                                <option value="">--</option>
                                <option value="3.6.1">Classical music</option>
                                <option value="3.6.2">Jazz</option>
                                <option value="3.6.3">Background music</option>
                                <option value="3.6.4">Pop-rock</option>
                                <option value="3.6.4.1">Pop</option>
                                <option value="3.6.4.11">Seasonal/Holiday</option>
                                <option value="3.6.4.14">Rock</option>
                                <option value="3.6.4.14.2">Metal</option>
                                <option value="3.6.4.17">Singer/Songwriter</option>
                                <option value="3.6.5">Blues/RnB/Soul/Gospel/Spiritual</option>
                                <option value="3.6.6">Country and Western</option>
                                <option value="3.6.7">Rap/Hip Hop/Reggae</option>
                                <option value="3.6.8">Electronic/Club/Urban/Dance/DJ</option>
                                <option value="3.6.8.3">Techno/Industrial</option>
                                <option value="3.6.8.4">House/Techno House</option>
                                <option value="3.6.9">World/Traditional</option>
                                <option value="3.6.10">Hit-Chart/Song Requests</option>
                                <option value="">--</option>
                                <option value="3.1.1.6">National/Politics</option>
                                <option value="3.1.1.9">Sports</option>
                                <option value="3.1.1.12">Traffic</option>
                                <option value="3.1.1.14">Service information</option>
                                <option value="3.6.13">Spoken</option>
                            </select>
                        </td>
                        <td>
                            <input type="text" name="genrehref[]" id="genre-href-" class="genre-href form-control" value="{{g.href}}">
                        </td>
                        <td>
                            <input type="text" name="genrename[]" id="genre-name-" class="genre-name form-control" value="{{g.name}}">
                        </td>
                        <td>
                            <a href="#" onclick="return del_genre(this);">Remove</a>
                        </td>
                    </tr>
				{% for g in object.genres_list %}

                    <tr class="genre_row" >
                        <td>
                            <select class="genre-select form-control">
                                <option value="">--</option>
                                <option value="3.1.1">News</option>
                                <option value="3.1.1.11">Local/Regional</option>
                                <option value="">--</option>
                                <option value="3.6.1">Classical music</option>
                                <option value="3.6.2">Jazz</option>
                                <option value="3.6.3">Background music</option>
                                <option value="3.6.4">Pop-rock</option>
                                <option value="3.6.4.1">Pop</option>
                                <option value="3.6.4.11">Seasonal/Holiday</option>
                                <option value="3.6.4.14">Rock</option>
                                <option value="3.6.4.14.2">Metal</option>
                                <option value="3.6.4.17">Singer/Songwriter</option>
                                <option value="3.6.5">Blues/RnB/Soul/Gospel/Spiritual</option>
                                <option value="3.6.6">Country and Western</option>
                                <option value="3.6.7">Rap/Hip Hop/Reggae</option>
                                <option value="3.6.8">Electronic/Club/Urban/Dance/DJ</option>
                                <option value="3.6.8.3">Techno/Industrial</option>
                                <option value="3.6.8.4">House/Techno House</option>
                                <option value="3.6.9">World/Traditional</option>
                                <option value="3.6.10">Hit-Chart/Song Requests</option>
                                <option value="">--</option>
                                <option value="3.1.1.6">National/Politics</option>
                                <option value="3.1.1.9">Sports</option>
                                <option value="3.1.1.12">Traffic</option>
                                <option value="3.1.1.14">Service information</option>
                                <option value="3.6.13">Spoken</option>
                            </select>
                        </td>
                        <td>
                            <input type="text" name="genrehref[]" class="genre-href form-control" value="{{g.href}}">
                        </td>
                        <td>
                            <input type="text" name="genrename[]" class="genre-name form-control" value="{{g.name}}">
                        </td>
                        <td>
                            <a href="#" onclick="return del_genre(this);">Remove</a>
                        </td>
                    </tr>

				{% endfor %}

				</table>
                <script type="text/javascript">

                    function changeGenreSelection(row) {
                      var genreUrn = "urn:tva:metadata:cs:ContentCS:2011:";
                      row.parents('.genre_row').find('.genre-href').val(genreUrn + row.parents('.genre_row').find('.genre-select').val());
                      row.parents('.genre_row').find('.genre-name').val(row.parents('.genre_row').find( ".genre-select option:selected" ).text());
                    }


                    $('.genre-select').on('change', function() { changeGenreSelection($( this )); });

                    var number = 0;
                    function append_genre_select() {
                        var temp = $('#genre_row_template').clone();
                        temp = temp.show();
                        temp = temp.html(function(index,html){
                            var a = html.replace(/genre-select-/g,'genre-select-'+number);
                            a = a.replace(/genre-href-/g,'genre-href-'+number);
                            a = a.replace(/genre-name-/g,'genre-name-'+number);
                            return a;
                        });
                        temp = temp.attr("id",temp.attr("id")+'-'+number);
                        temp.find('.genre-select').on('change', function() { changeGenreSelection($( this )); });

                        $('#genre_row_template').parent().append(temp);

                        number++;
                    }
                </script>
                <a class="btn btn-xs btn-default" onclick="append_genre_select();">New genre</a>
			</div>
		</div>
		<label></label>


		<hr />

		<div class="form-group">
			<label class="col-sm-3 col-md-3 control-label">Enable RadioVIS:</label>
			<div class="col-sm-9 col-md-7">
				<input type="checkbox" name="radiovis_enabled" id="radiovis_enabled" class="form-control" value="radiovis_enabled" {% if object.radiovis_enabled %} checked="checked" {% endif %} />
			</div>
		</div>
		<div id="radiovis_enabled_options" {% if not object.radiovis_enabled %} style="display:none;" {% endif %}>
			<div class="form-group" >
				<label class="col-sm-3 col-md-3 control-label">RadioVIS Service Uri:</label>
				<div class="col-sm-9 col-md-7">
					<input type="text" name="radiovis_service" id="radiovis_service" class="form-control" value="{{object.radiovis_service}}" />
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 col-md-3 control-label">IPs allowed to connect<br /> to the radiovis server:</label>
				<div class="col-sm-9 col-md-7">
					<input type="text" name="ip_allowed" class="form-control" value="{{object.ip_allowed}}"><br />
					<small>
						A list of ip.ip.ip.ip/subnet, comma separted. E.g.: <i>127.0.0.1/32, 0.0.0.0/0, 192.168.42.0/24</i>
					</small>
				</div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-md-3 control-label">Enable RadioEPG:</label>
			<div class="col-sm-9 col-md-7">
				<input type="checkbox" name="radioepg_enabled" id="radioepg_enabled" class="form-control" value="radioepg_enabled" {% if object.radioepg_enabled %} checked="checked" {% endif %} />
			</div>
		</div>
		<div class="form-group" id="radioepg_enabled_options" {% if not object.radioepg_enabled %} style="display:none;" {% endif %}>
			<label class="col-sm-3 col-md-3 control-label">RadioEPG Service Uri:</label>
			<div class="col-sm-9 col-md-7">
				<input type="text" name="radioepg_service" id="radioepg_service" class="form-control" value="{{object.radioepg_service}}" />
			</div>
		</div>
		{% if RADIOTAG_ENABLED %}
		<div class="form-group">
			<label class="col-sm-3 col-md-3 control-label">Enable RadioTAG:</label>
			<div class="col-sm-9 col-md-7">
				<input type="checkbox" name="radiotag_enabled" id="radiotag_enabled" class="form-control" value="radiotag_enabled" {% if object.radiotag_enabled %} checked="checked" {% endif %} />
			</div>
		</div>
		<div class="form-group" id="radiotag_enabled_options" {% if not object.radiotag_enabled %} style="display:none;" {% endif %}>
			<label class="col-sm-3 col-md-3 control-label">RadioTAG Service Uri:</label>
			<div class="col-sm-9 col-md-7">
				<input type="text" name="radiotag_service" id="radiotag_service" class="form-control" value="{{object.radiotag_service}}" />
			</div>
		</div>
		{% endif %}

		<hr />

		<div class="form-group">
			<div class="col-sm-4 col-sm-offset-3">
				<input type="submit" class="btn btn-primary" value="Save">
				<a href="{{ebuio_baseUrl}}stations/" class="btn btn-default">Cancel</a>
			</div>
		</div>


	</form>

	<script type="text/javascript">

		function del_genre(elem) {
			$(elem).parent().parent().remove();
			return false;
		}

		{% if object.id %}
		var initialName = $('#station-name').val();
		$('#station-name').keypress(function( event ) {
			var newName = $('#station-name').val();
			if(initialName != newName) {
				$('#station-name-change-warning').show();
			} else {
				$('#station-name-change-warning').hide();
			}
		});
		$('#station-name').change(function( event ) {
			var newName = $('#station-name').val();
			if(initialName != newName) {
				$('#station-name-change-warning').show();
			} else {
				$('#station-name-change-warning').hide();
			}
		});
		{% endif %}

		$('#radiovis_enabled').click(function () {
			$("#radiovis_enabled_options").toggle(this.checked);
			if(this.checked && $("#radiovis_service").val() == "") {
				$("#radiovis_service").val('{{default_radiovis_service}}');
			} else {
				$("#radiovis_service").val('');
			}
		});
		$('#radioepg_enabled').click(function () {
			$("#radioepg_enabled_options").toggle(this.checked);
			if(this.checked && $("#radioepg_service").val() == "") {
				$("#radioepg_service").val('{{default_radioepg_service}}')
			} else {
				$("#radioepg_service").val('');
			}
		});
		$('#radiotag_enabled').click(function () {
			$("#radiotag_enabled_options").toggle(this.checked);
			if(this.checked && $("#radiotag_service").val() == "") {
				$("#radiotag_service").val('{{default_radiotag_service}}')
			} else {
				$("#radiotag_service").val('');
			}
		});

	</script>


{% endblock %}

